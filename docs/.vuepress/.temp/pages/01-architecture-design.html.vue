<template><div><h1 id="vue3æ¶æ„è®¾è®¡è¯¦è§£" tabindex="-1"><a class="header-anchor" href="#vue3æ¶æ„è®¾è®¡è¯¦è§£"><span>Vue3æ¶æ„è®¾è®¡è¯¦è§£</span></a></h1>
<h2 id="ğŸ—ï¸-æ•´ä½“æ¶æ„æ¦‚è¿°" tabindex="-1"><a class="header-anchor" href="#ğŸ—ï¸-æ•´ä½“æ¶æ„æ¦‚è¿°"><span>ğŸ—ï¸ æ•´ä½“æ¶æ„æ¦‚è¿°</span></a></h2>
<p>Vue3é‡‡ç”¨äº†<strong>åˆ†å±‚æ¶æ„</strong>è®¾è®¡ï¼Œå°†ä¸åŒåŠŸèƒ½æ¨¡å—è§£è€¦ï¼Œå®ç°äº†æ›´å¥½çš„å¯ç»´æŠ¤æ€§å’Œå¯æ‰©å±•æ€§ã€‚</p>
<h3 id="æ¶æ„å±‚æ¬¡å›¾" tabindex="-1"><a class="header-anchor" href="#æ¶æ„å±‚æ¬¡å›¾"><span>æ¶æ„å±‚æ¬¡å›¾</span></a></h3>
<div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre v-pre><code><span class="line">â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”</span>
<span class="line">â”‚          åº”ç”¨å±‚ (App Layer)         â”‚</span>
<span class="line">â”‚  createApp() | mount() | unmount() â”‚</span>
<span class="line">â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤</span>
<span class="line">â”‚        è¿è¡Œæ—¶å±‚ (Runtime Layer)     â”‚</span>
<span class="line">â”‚  runtime-core | runtime-dom | test â”‚</span>
<span class="line">â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤</span>
<span class="line">â”‚        ç¼–è¯‘å±‚ (Compiler Layer)      â”‚</span>
<span class="line">â”‚  compiler-core | compiler-dom | sfcâ”‚</span>
<span class="line">â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤</span>
<span class="line">â”‚      å“åº”å¼å±‚ (Reactivity Layer)    â”‚</span>
<span class="line">â”‚           @vue/reactivity           â”‚</span>
<span class="line">â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</span>
<span class="line"></span></code></pre>
<div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="ğŸ“¦-æ¨¡å—åŒ–æ¶æ„è®¾è®¡" tabindex="-1"><a class="header-anchor" href="#ğŸ“¦-æ¨¡å—åŒ–æ¶æ„è®¾è®¡"><span>ğŸ“¦ æ¨¡å—åŒ–æ¶æ„è®¾è®¡</span></a></h2>
<h3 id="_1-åŒ…ç»“æ„è®¾è®¡" tabindex="-1"><a class="header-anchor" href="#_1-åŒ…ç»“æ„è®¾è®¡"><span>1. åŒ…ç»“æ„è®¾è®¡</span></a></h3>
<div class="language-typescript line-numbers-mode" data-highlighter="prismjs" data-ext="ts"><pre v-pre><code><span class="line"><span class="token comment">// æ ¸å¿ƒåŒ…ç»“æ„</span></span>
<span class="line"><span class="token function">vue</span> <span class="token punctuation">(</span>ä¸»åŒ…<span class="token punctuation">)</span></span>
<span class="line">â”œâ”€â”€ <span class="token decorator"><span class="token at operator">@</span><span class="token function">vue</span></span><span class="token operator">/</span>runtime<span class="token operator">-</span><span class="token function">dom</span> <span class="token punctuation">(</span>æµè§ˆå™¨è¿è¡Œæ—¶<span class="token punctuation">)</span></span>
<span class="line">â”œâ”€â”€ <span class="token decorator"><span class="token at operator">@</span><span class="token function">vue</span></span><span class="token operator">/</span>runtime<span class="token operator">-</span><span class="token function">core</span> <span class="token punctuation">(</span>æ ¸å¿ƒè¿è¡Œæ—¶<span class="token punctuation">)</span></span>
<span class="line">â”œâ”€â”€ <span class="token decorator"><span class="token at operator">@</span><span class="token function">vue</span></span><span class="token operator">/</span><span class="token function">reactivity</span> <span class="token punctuation">(</span>å“åº”å¼ç³»ç»Ÿ<span class="token punctuation">)</span></span>
<span class="line">â”œâ”€â”€ <span class="token decorator"><span class="token at operator">@</span><span class="token function">vue</span></span><span class="token operator">/</span>compiler<span class="token operator">-</span><span class="token function">dom</span> <span class="token punctuation">(</span>æ¨¡æ¿ç¼–è¯‘å™¨<span class="token punctuation">)</span></span>
<span class="line">â”œâ”€â”€ <span class="token decorator"><span class="token at operator">@</span><span class="token function">vue</span></span><span class="token operator">/</span>compiler<span class="token operator">-</span><span class="token function">core</span> <span class="token punctuation">(</span>ç¼–è¯‘å™¨æ ¸å¿ƒ<span class="token punctuation">)</span></span>
<span class="line">â”œâ”€â”€ <span class="token decorator"><span class="token at operator">@</span><span class="token function">vue</span></span><span class="token operator">/</span>compiler<span class="token operator">-</span><span class="token function">sfc</span> <span class="token punctuation">(</span><span class="token constant">SFC</span>ç¼–è¯‘å™¨<span class="token punctuation">)</span></span>
<span class="line">â””â”€â”€ <span class="token decorator"><span class="token at operator">@</span><span class="token function">vue</span></span><span class="token operator">/</span><span class="token function">shared</span> <span class="token punctuation">(</span>å…±äº«å·¥å…·<span class="token punctuation">)</span></span>
<span class="line"></span></code></pre>
<div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_2-åŒ…ä¾èµ–å…³ç³»" tabindex="-1"><a class="header-anchor" href="#_2-åŒ…ä¾èµ–å…³ç³»"><span>2. åŒ…ä¾èµ–å…³ç³»</span></a></h3>
<div class="language-mermaid line-numbers-mode" data-highlighter="prismjs" data-ext="mermaid"><pre v-pre><code><span class="line"><span class="token keyword">graph</span> TB</span>
<span class="line">    vue<span class="token text string">[vue ä¸»åŒ…]</span> <span class="token arrow operator">--></span> runtime-dom<span class="token text string">[@vue/runtime-dom]</span></span>
<span class="line">    vue <span class="token arrow operator">--></span> compiler-dom<span class="token text string">[@vue/compiler-dom]</span></span>
<span class="line"></span>
<span class="line">    runtime-dom <span class="token arrow operator">--></span> runtime-core<span class="token text string">[@vue/runtime-core]</span></span>
<span class="line">    runtime-core <span class="token arrow operator">--></span> reactivity<span class="token text string">[@vue/reactivity]</span></span>
<span class="line"></span>
<span class="line">    compiler-dom <span class="token arrow operator">--></span> compiler-core<span class="token text string">[@vue/compiler-core]</span></span>
<span class="line">    compiler-sfc<span class="token text string">[@vue/compiler-sfc]</span> <span class="token arrow operator">--></span> compiler-core</span>
<span class="line">    compiler-sfc <span class="token arrow operator">--></span> compiler-dom</span>
<span class="line"></span>
<span class="line">    runtime-core <span class="token arrow operator">--></span> shared<span class="token text string">[@vue/shared]</span></span>
<span class="line">    compiler-core <span class="token arrow operator">--></span> shared</span>
<span class="line"></span></code></pre>
<div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_3-æ¨¡å—èŒè´£åˆ†ç¦»" tabindex="-1"><a class="header-anchor" href="#_3-æ¨¡å—èŒè´£åˆ†ç¦»"><span>3. æ¨¡å—èŒè´£åˆ†ç¦»</span></a></h3>
<h4 id="_3-1-åº”ç”¨å±‚-app-layer" tabindex="-1"><a class="header-anchor" href="#_3-1-åº”ç”¨å±‚-app-layer"><span>3.1 åº”ç”¨å±‚ (App Layer)</span></a></h4>
<div class="language-typescript line-numbers-mode" data-highlighter="prismjs" data-ext="ts"><pre v-pre><code><span class="line"><span class="token comment">// åº”ç”¨åˆ›å»ºå’Œç®¡ç†</span></span>
<span class="line"><span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">createApp</span><span class="token punctuation">(</span></span>
<span class="line">  rootComponent<span class="token operator">:</span> Component<span class="token punctuation">,</span></span>
<span class="line">  rootProps<span class="token operator">?</span><span class="token operator">:</span> Data <span class="token operator">|</span> <span class="token keyword">null</span><span class="token punctuation">,</span></span>
<span class="line"><span class="token punctuation">)</span><span class="token operator">:</span> App</span>
<span class="line"><span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">createSSRApp</span><span class="token punctuation">(</span></span>
<span class="line">  rootComponent<span class="token operator">:</span> Component<span class="token punctuation">,</span></span>
<span class="line">  rootProps<span class="token operator">?</span><span class="token operator">:</span> Data <span class="token operator">|</span> <span class="token keyword">null</span><span class="token punctuation">,</span></span>
<span class="line"><span class="token punctuation">)</span><span class="token operator">:</span> App</span>
<span class="line"></span>
<span class="line"><span class="token comment">// åº”ç”¨å®ä¾‹æ¥å£</span></span>
<span class="line"><span class="token keyword">interface</span> <span class="token class-name">App</span> <span class="token punctuation">{</span></span>
<span class="line">  version<span class="token operator">:</span> <span class="token builtin">string</span></span>
<span class="line">  config<span class="token operator">:</span> AppConfig</span>
<span class="line">  <span class="token function">use</span><span class="token punctuation">(</span>plugin<span class="token operator">:</span> Plugin<span class="token punctuation">,</span> <span class="token operator">...</span>options<span class="token operator">:</span> <span class="token builtin">any</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token keyword">this</span></span>
<span class="line">  <span class="token function">mixin</span><span class="token punctuation">(</span>mixin<span class="token operator">:</span> ComponentOptions<span class="token punctuation">)</span><span class="token operator">:</span> <span class="token keyword">this</span></span>
<span class="line">  <span class="token function">component</span><span class="token punctuation">(</span>name<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">,</span> component<span class="token operator">?</span><span class="token operator">:</span> Component<span class="token punctuation">)</span><span class="token operator">:</span> <span class="token keyword">this</span></span>
<span class="line">  <span class="token function">directive</span><span class="token punctuation">(</span>name<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">,</span> directive<span class="token operator">?</span><span class="token operator">:</span> Directive<span class="token punctuation">)</span><span class="token operator">:</span> <span class="token keyword">this</span></span>
<span class="line">  <span class="token function">mount</span><span class="token punctuation">(</span>rootContainer<span class="token operator">:</span> Element <span class="token operator">|</span> <span class="token builtin">string</span><span class="token punctuation">)</span><span class="token operator">:</span> ComponentPublicInstance</span>
<span class="line">  <span class="token function">unmount</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token keyword">void</span></span>
<span class="line">  <span class="token function">provide</span><span class="token punctuation">(</span>key<span class="token operator">:</span> InjectionKey<span class="token operator">&lt;</span><span class="token builtin">any</span><span class="token operator">></span> <span class="token operator">|</span> <span class="token builtin">string</span><span class="token punctuation">,</span> value<span class="token operator">:</span> <span class="token builtin">any</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token keyword">this</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre>
<div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_3-2-è¿è¡Œæ—¶å±‚-runtime-layer" tabindex="-1"><a class="header-anchor" href="#_3-2-è¿è¡Œæ—¶å±‚-runtime-layer"><span>3.2 è¿è¡Œæ—¶å±‚ (Runtime Layer)</span></a></h4>
<div class="language-typescript line-numbers-mode" data-highlighter="prismjs" data-ext="ts"><pre v-pre><code><span class="line"><span class="token comment">// runtime-core: å¹³å°æ— å…³çš„æ ¸å¿ƒè¿è¡Œæ—¶</span></span>
<span class="line"><span class="token keyword">export</span> <span class="token keyword">interface</span> <span class="token class-name">Renderer<span class="token operator">&lt;</span>HostElement <span class="token operator">=</span> RendererElement<span class="token operator">></span></span> <span class="token punctuation">{</span></span>
<span class="line">  render<span class="token operator">:</span> RootRenderFunction<span class="token operator">&lt;</span>HostElement<span class="token operator">></span></span>
<span class="line">  createApp<span class="token operator">:</span> CreateAppFunction<span class="token operator">&lt;</span>HostElement<span class="token operator">></span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">// runtime-dom: æµè§ˆå™¨å¹³å°ç‰¹å®šå®ç°</span></span>
<span class="line"><span class="token keyword">export</span> <span class="token keyword">interface</span> <span class="token class-name">RendererOptions<span class="token operator">&lt;</span>HostNode<span class="token punctuation">,</span> HostElement<span class="token operator">></span></span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token function">patchProp</span><span class="token punctuation">(</span>el<span class="token operator">:</span> HostElement<span class="token punctuation">,</span> key<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">,</span> prevValue<span class="token operator">:</span> <span class="token builtin">any</span><span class="token punctuation">,</span> nextValue<span class="token operator">:</span> <span class="token builtin">any</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token keyword">void</span></span>
<span class="line">  <span class="token function">insert</span><span class="token punctuation">(</span>el<span class="token operator">:</span> HostNode<span class="token punctuation">,</span> parent<span class="token operator">:</span> HostElement<span class="token punctuation">,</span> anchor<span class="token operator">?</span><span class="token operator">:</span> HostNode<span class="token punctuation">)</span><span class="token operator">:</span> <span class="token keyword">void</span></span>
<span class="line">  <span class="token function">remove</span><span class="token punctuation">(</span>el<span class="token operator">:</span> HostNode<span class="token punctuation">)</span><span class="token operator">:</span> <span class="token keyword">void</span></span>
<span class="line">  <span class="token function">createElement</span><span class="token punctuation">(</span>type<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">)</span><span class="token operator">:</span> HostElement</span>
<span class="line">  <span class="token function">createText</span><span class="token punctuation">(</span>text<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">)</span><span class="token operator">:</span> HostNode</span>
<span class="line">  <span class="token function">setText</span><span class="token punctuation">(</span>node<span class="token operator">:</span> HostNode<span class="token punctuation">,</span> text<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token keyword">void</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre>
<div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_3-3-ç¼–è¯‘å±‚-compiler-layer" tabindex="-1"><a class="header-anchor" href="#_3-3-ç¼–è¯‘å±‚-compiler-layer"><span>3.3 ç¼–è¯‘å±‚ (Compiler Layer)</span></a></h4>
<div class="language-typescript line-numbers-mode" data-highlighter="prismjs" data-ext="ts"><pre v-pre><code><span class="line"><span class="token comment">// compiler-core: å¹³å°æ— å…³çš„ç¼–è¯‘å™¨æ ¸å¿ƒ</span></span>
<span class="line"><span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">baseCompile</span><span class="token punctuation">(</span></span>
<span class="line">  source<span class="token operator">:</span> <span class="token builtin">string</span> <span class="token operator">|</span> RootNode<span class="token punctuation">,</span></span>
<span class="line">  options<span class="token operator">:</span> CompilerOptions <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line"><span class="token punctuation">)</span><span class="token operator">:</span> CodegenResult</span>
<span class="line"></span>
<span class="line"><span class="token comment">// compiler-dom: æµè§ˆå™¨å¹³å°ç‰¹å®šç¼–è¯‘å™¨</span></span>
<span class="line"><span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">compile</span><span class="token punctuation">(</span></span>
<span class="line">  source<span class="token operator">:</span> <span class="token builtin">string</span> <span class="token operator">|</span> RootNode<span class="token punctuation">,</span></span>
<span class="line">  options<span class="token operator">?</span><span class="token operator">:</span> CompilerOptions<span class="token punctuation">,</span></span>
<span class="line"><span class="token punctuation">)</span><span class="token operator">:</span> CodegenResult</span>
<span class="line"></span>
<span class="line"><span class="token comment">// compiler-sfc: å•æ–‡ä»¶ç»„ä»¶ç¼–è¯‘å™¨</span></span>
<span class="line"><span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">compileTemplate</span><span class="token punctuation">(</span></span>
<span class="line">  options<span class="token operator">:</span> CompileTemplateOptions<span class="token punctuation">,</span></span>
<span class="line"><span class="token punctuation">)</span><span class="token operator">:</span> CompileTemplateResult</span>
<span class="line"></span></code></pre>
<div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_3-4-å“åº”å¼å±‚-reactivity-layer" tabindex="-1"><a class="header-anchor" href="#_3-4-å“åº”å¼å±‚-reactivity-layer"><span>3.4 å“åº”å¼å±‚ (Reactivity Layer)</span></a></h4>
<div class="language-typescript line-numbers-mode" data-highlighter="prismjs" data-ext="ts"><pre v-pre><code><span class="line"><span class="token comment">// å“åº”å¼ç³»ç»Ÿæ ¸å¿ƒAPI</span></span>
<span class="line"><span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token generic-function"><span class="token function">reactive</span><span class="token generic class-name"><span class="token operator">&lt;</span><span class="token constant">T</span> <span class="token keyword">extends</span> object<span class="token operator">></span></span></span><span class="token punctuation">(</span>target<span class="token operator">:</span> <span class="token constant">T</span><span class="token punctuation">)</span><span class="token operator">:</span> Reactive<span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">></span></span>
<span class="line"><span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token generic-function"><span class="token function">ref</span><span class="token generic class-name"><span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">></span></span></span><span class="token punctuation">(</span>value<span class="token operator">:</span> <span class="token constant">T</span><span class="token punctuation">)</span><span class="token operator">:</span> Ref<span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">></span></span>
<span class="line"><span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token generic-function"><span class="token function">computed</span><span class="token generic class-name"><span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">></span></span></span><span class="token punctuation">(</span><span class="token function-variable function">getter</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token constant">T</span><span class="token punctuation">)</span><span class="token operator">:</span> ComputedRef<span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">></span></span>
<span class="line"><span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token generic-function"><span class="token function">watch</span><span class="token generic class-name"><span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">></span></span></span><span class="token punctuation">(</span>source<span class="token operator">:</span> <span class="token constant">T</span><span class="token punctuation">,</span> callback<span class="token operator">:</span> WatchCallback<span class="token punctuation">)</span><span class="token operator">:</span> WatchStopHandle</span>
<span class="line"></span></code></pre>
<div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="ğŸ¯-è®¾è®¡åŸåˆ™" tabindex="-1"><a class="header-anchor" href="#ğŸ¯-è®¾è®¡åŸåˆ™"><span>ğŸ¯ è®¾è®¡åŸåˆ™</span></a></h2>
<h3 id="_1-æ¸è¿›å¼è®¾è®¡" tabindex="-1"><a class="header-anchor" href="#_1-æ¸è¿›å¼è®¾è®¡"><span>1. æ¸è¿›å¼è®¾è®¡</span></a></h3>
<ul>
<li><strong>æŒ‰éœ€å¼•å…¥</strong> - å¯ä»¥æ ¹æ®éœ€è¦é€‰æ‹©åŠŸèƒ½æ¨¡å—</li>
<li><strong>Tree-shaking</strong> - æ”¯æŒæ‰“åŒ…å·¥å…·ç§»é™¤æœªä½¿ç”¨çš„ä»£ç </li>
<li><strong>æ¨¡å—åŒ–</strong> - æ¯ä¸ªåŠŸèƒ½éƒ½æ˜¯ç‹¬ç«‹çš„æ¨¡å—</li>
</ul>
<h3 id="_2-å¹³å°æŠ½è±¡" tabindex="-1"><a class="header-anchor" href="#_2-å¹³å°æŠ½è±¡"><span>2. å¹³å°æŠ½è±¡</span></a></h3>
<div class="language-typescript line-numbers-mode" data-highlighter="prismjs" data-ext="ts"><pre v-pre><code><span class="line"><span class="token comment">// æ¸²æŸ“å™¨æŠ½è±¡</span></span>
<span class="line"><span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token generic-function"><span class="token function">createRenderer</span><span class="token generic class-name"><span class="token operator">&lt;</span>HostNode<span class="token punctuation">,</span> HostElement<span class="token operator">></span></span></span><span class="token punctuation">(</span></span>
<span class="line">  options<span class="token operator">:</span> RendererOptions<span class="token operator">&lt;</span>HostNode<span class="token punctuation">,</span> HostElement<span class="token operator">></span><span class="token punctuation">,</span></span>
<span class="line"><span class="token punctuation">)</span><span class="token operator">:</span> Renderer<span class="token operator">&lt;</span>HostElement<span class="token operator">></span></span>
<span class="line"></span>
<span class="line"><span class="token comment">// æ”¯æŒå¤šå¹³å°</span></span>
<span class="line"><span class="token keyword">const</span> renderer <span class="token operator">=</span> <span class="token function">createRenderer</span><span class="token punctuation">(</span><span class="token punctuation">{</span></span>
<span class="line">  <span class="token comment">// æµè§ˆå™¨å¹³å°</span></span>
<span class="line">  <span class="token function-variable function">patchProp</span><span class="token operator">:</span> <span class="token punctuation">(</span>el<span class="token punctuation">,</span> key<span class="token punctuation">,</span> prev<span class="token punctuation">,</span> next<span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token comment">/* DOMæ“ä½œ */</span></span>
<span class="line">  <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">  <span class="token function-variable function">insert</span><span class="token operator">:</span> <span class="token punctuation">(</span>child<span class="token punctuation">,</span> parent<span class="token punctuation">,</span> anchor<span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token comment">/* DOMæ’å…¥ */</span></span>
<span class="line">  <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">  <span class="token comment">// ... å…¶ä»–å¹³å°ç‰¹å®šå®ç°</span></span>
<span class="line"><span class="token punctuation">}</span><span class="token punctuation">)</span></span>
<span class="line"></span></code></pre>
<div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_3-ç±»å‹å®‰å…¨" tabindex="-1"><a class="header-anchor" href="#_3-ç±»å‹å®‰å…¨"><span>3. ç±»å‹å®‰å…¨</span></a></h3>
<div class="language-typescript line-numbers-mode" data-highlighter="prismjs" data-ext="ts"><pre v-pre><code><span class="line"><span class="token comment">// å®Œæ•´çš„TypeScriptæ”¯æŒ</span></span>
<span class="line"><span class="token keyword">export</span> <span class="token keyword">interface</span> <span class="token class-name">ComponentInternalInstance</span> <span class="token punctuation">{</span></span>
<span class="line">  uid<span class="token operator">:</span> <span class="token builtin">number</span></span>
<span class="line">  type<span class="token operator">:</span> ConcreteComponent</span>
<span class="line">  vnode<span class="token operator">:</span> VNode</span>
<span class="line">  subTree<span class="token operator">:</span> VNode</span>
<span class="line">  effect<span class="token operator">:</span> ReactiveEffect</span>
<span class="line">  render<span class="token operator">:</span> InternalRenderFunction</span>
<span class="line">  <span class="token comment">// ... æ›´å¤šç±»å‹å®šä¹‰</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre>
<div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="ğŸ”§-æ¶æ„ä¼˜åŠ¿" tabindex="-1"><a class="header-anchor" href="#ğŸ”§-æ¶æ„ä¼˜åŠ¿"><span>ğŸ”§ æ¶æ„ä¼˜åŠ¿</span></a></h2>
<h3 id="_1-å¯ç»´æŠ¤æ€§" tabindex="-1"><a class="header-anchor" href="#_1-å¯ç»´æŠ¤æ€§"><span>1. å¯ç»´æŠ¤æ€§</span></a></h3>
<ul>
<li><strong>èŒè´£åˆ†ç¦»</strong> - æ¯ä¸ªæ¨¡å—èŒè´£æ˜ç¡®</li>
<li><strong>æ¥å£æ¸…æ™°</strong> - æ¨¡å—é—´é€šè¿‡æ¥å£é€šä¿¡</li>
<li><strong>æµ‹è¯•å‹å¥½</strong> - æ¯ä¸ªæ¨¡å—å¯ä»¥ç‹¬ç«‹æµ‹è¯•</li>
</ul>
<h3 id="_2-å¯æ‰©å±•æ€§" tabindex="-1"><a class="header-anchor" href="#_2-å¯æ‰©å±•æ€§"><span>2. å¯æ‰©å±•æ€§</span></a></h3>
<ul>
<li><strong>æ’ä»¶ç³»ç»Ÿ</strong> - æ”¯æŒåŠŸèƒ½æ‰©å±•</li>
<li><strong>è‡ªå®šä¹‰æ¸²æŸ“å™¨</strong> - æ”¯æŒä¸åŒå¹³å°</li>
<li><strong>ç¼–è¯‘å™¨æ‰©å±•</strong> - æ”¯æŒè‡ªå®šä¹‰ç¼–è¯‘ä¼˜åŒ–</li>
</ul>
<h3 id="_3-æ€§èƒ½ä¼˜åŒ–" tabindex="-1"><a class="header-anchor" href="#_3-æ€§èƒ½ä¼˜åŒ–"><span>3. æ€§èƒ½ä¼˜åŒ–</span></a></h3>
<ul>
<li><strong>æŒ‰éœ€åŠ è½½</strong> - åªåŠ è½½éœ€è¦çš„åŠŸèƒ½</li>
<li><strong>ç¼–è¯‘ä¼˜åŒ–</strong> - ç¼–è¯‘æ—¶è¿›è¡Œä¼˜åŒ–</li>
<li><strong>è¿è¡Œæ—¶ä¼˜åŒ–</strong> - è¿è¡Œæ—¶æ™ºèƒ½è°ƒåº¦</li>
</ul>
<h2 id="ğŸ“Š-å®é™…åº”ç”¨" tabindex="-1"><a class="header-anchor" href="#ğŸ“Š-å®é™…åº”ç”¨"><span>ğŸ“Š å®é™…åº”ç”¨</span></a></h2>
<h3 id="_1-åˆ›å»ºåº”ç”¨" tabindex="-1"><a class="header-anchor" href="#_1-åˆ›å»ºåº”ç”¨"><span>1. åˆ›å»ºåº”ç”¨</span></a></h3>
<div class="language-typescript line-numbers-mode" data-highlighter="prismjs" data-ext="ts"><pre v-pre><code><span class="line"><span class="token keyword">import</span> <span class="token punctuation">{</span> createApp <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'vue'</span></span>
<span class="line"><span class="token keyword">import</span> App <span class="token keyword">from</span> <span class="token string">'./App.vue'</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token function">createApp</span><span class="token punctuation">(</span>App<span class="token punctuation">)</span></span>
<span class="line">app<span class="token punctuation">.</span><span class="token function">mount</span><span class="token punctuation">(</span><span class="token string">'#app'</span><span class="token punctuation">)</span></span>
<span class="line"></span></code></pre>
<div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_2-è‡ªå®šä¹‰æ¸²æŸ“å™¨" tabindex="-1"><a class="header-anchor" href="#_2-è‡ªå®šä¹‰æ¸²æŸ“å™¨"><span>2. è‡ªå®šä¹‰æ¸²æŸ“å™¨</span></a></h3>
<div class="language-typescript line-numbers-mode" data-highlighter="prismjs" data-ext="ts"><pre v-pre><code><span class="line"><span class="token keyword">import</span> <span class="token punctuation">{</span> createRenderer <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@vue/runtime-core'</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">// åˆ›å»ºCanvasæ¸²æŸ“å™¨</span></span>
<span class="line"><span class="token keyword">const</span> <span class="token punctuation">{</span> render<span class="token punctuation">,</span> createApp <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">createRenderer</span><span class="token punctuation">(</span><span class="token punctuation">{</span></span>
<span class="line">  <span class="token function-variable function">patchProp</span><span class="token operator">:</span> <span class="token punctuation">(</span>el<span class="token punctuation">,</span> key<span class="token punctuation">,</span> prev<span class="token punctuation">,</span> next<span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token comment">// Canvaså±æ€§æ›´æ–°</span></span>
<span class="line">  <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">  <span class="token function-variable function">insert</span><span class="token operator">:</span> <span class="token punctuation">(</span>child<span class="token punctuation">,</span> parent<span class="token punctuation">,</span> anchor<span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token comment">// Canvaså…ƒç´ æ’å…¥</span></span>
<span class="line">  <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">  <span class="token comment">// ... å…¶ä»–Canvasç‰¹å®šå®ç°</span></span>
<span class="line"><span class="token punctuation">}</span><span class="token punctuation">)</span></span>
<span class="line"></span></code></pre>
<div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_3-æœåŠ¡ç«¯æ¸²æŸ“" tabindex="-1"><a class="header-anchor" href="#_3-æœåŠ¡ç«¯æ¸²æŸ“"><span>3. æœåŠ¡ç«¯æ¸²æŸ“</span></a></h3>
<div class="language-typescript line-numbers-mode" data-highlighter="prismjs" data-ext="ts"><pre v-pre><code><span class="line"><span class="token keyword">import</span> <span class="token punctuation">{</span> createSSRApp <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'vue'</span></span>
<span class="line"><span class="token keyword">import</span> <span class="token punctuation">{</span> renderToString <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@vue/server-renderer'</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token function">createSSRApp</span><span class="token punctuation">(</span>App<span class="token punctuation">)</span></span>
<span class="line"><span class="token keyword">const</span> html <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">renderToString</span><span class="token punctuation">(</span>app<span class="token punctuation">)</span></span>
<span class="line"></span></code></pre>
<div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="ğŸ¯-æ€»ç»“" tabindex="-1"><a class="header-anchor" href="#ğŸ¯-æ€»ç»“"><span>ğŸ¯ æ€»ç»“</span></a></h2>
<p>Vue3çš„æ¶æ„è®¾è®¡ä½“ç°äº†ç°ä»£å‰ç«¯æ¡†æ¶çš„æœ€ä½³å®è·µï¼š</p>
<ol>
<li><strong>åˆ†å±‚æ¶æ„</strong> - æ¸…æ™°çš„èŒè´£åˆ†ç¦»</li>
<li><strong>æ¨¡å—åŒ–è®¾è®¡</strong> - é«˜å†…èšä½è€¦åˆ</li>
<li><strong>å¹³å°æŠ½è±¡</strong> - æ”¯æŒå¤šå¹³å°</li>
<li><strong>ç±»å‹å®‰å…¨</strong> - å®Œæ•´çš„TypeScriptæ”¯æŒ</li>
<li><strong>æ€§èƒ½ä¼˜åŒ–</strong> - ç¼–è¯‘æ—¶å’Œè¿è¡Œæ—¶ä¼˜åŒ–</li>
<li><strong>å¯æ‰©å±•æ€§</strong> - çµæ´»çš„æ’ä»¶ç³»ç»Ÿ</li>
</ol>
<p>è¿™ç§æ¶æ„è®¾è®¡ä¸ä»…ä¸ºVue3æä¾›äº†å¼ºå¤§çš„åŠŸèƒ½ï¼Œä¹Ÿä¸ºå…¶ä»–å‰ç«¯é¡¹ç›®æä¾›äº†ä¼˜ç§€çš„è®¾è®¡å‚è€ƒã€‚</p>
</div></template>


