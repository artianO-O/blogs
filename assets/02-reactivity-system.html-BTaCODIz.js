import{_ as s,c as a,a as p,o as e}from"./app-CKVE1pLk.js";const t={};function l(c,n){return e(),a("div",null,n[0]||(n[0]=[p(`<h1 id="vue3å“åº”å¼ç³»ç»Ÿè¯¦è§£" tabindex="-1"><a class="header-anchor" href="#vue3å“åº”å¼ç³»ç»Ÿè¯¦è§£"><span>Vue3å“åº”å¼ç³»ç»Ÿè¯¦è§£</span></a></h1><h2 id="ğŸ¯-å“åº”å¼ç³»ç»Ÿæ¦‚è¿°" tabindex="-1"><a class="header-anchor" href="#ğŸ¯-å“åº”å¼ç³»ç»Ÿæ¦‚è¿°"><span>ğŸ¯ å“åº”å¼ç³»ç»Ÿæ¦‚è¿°</span></a></h2><p>Vue3çš„å“åº”å¼ç³»ç»Ÿæ˜¯æ¡†æ¶çš„æ ¸å¿ƒï¼Œå®ƒåŸºäºProxyå®ç°äº†ç²¾ç¡®çš„ä¾èµ–è¿½è¸ªå’Œé«˜æ•ˆçš„æ›´æ–°æœºåˆ¶ã€‚</p><h3 id="ç³»ç»Ÿæ¶æ„å›¾" tabindex="-1"><a class="header-anchor" href="#ç³»ç»Ÿæ¶æ„å›¾"><span>ç³»ç»Ÿæ¶æ„å›¾</span></a></h3><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code><span class="line">â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”</span>
<span class="line">â”‚        å“åº”å¼APIå±‚ (API Layer)      â”‚</span>
<span class="line">â”‚  reactive() | ref() | computed()   â”‚</span>
<span class="line">â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤</span>
<span class="line">â”‚        ä¾èµ–è¿½è¸ªå±‚ (Tracking Layer)  â”‚</span>
<span class="line">â”‚      track() | trigger() | effect() â”‚</span>
<span class="line">â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤</span>
<span class="line">â”‚        ä»£ç†å±‚ (Proxy Layer)         â”‚</span>
<span class="line">â”‚  baseHandlers | collectionHandlers â”‚</span>
<span class="line">â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="ğŸ”„-æ ¸å¿ƒæ¦‚å¿µ" tabindex="-1"><a class="header-anchor" href="#ğŸ”„-æ ¸å¿ƒæ¦‚å¿µ"><span>ğŸ”„ æ ¸å¿ƒæ¦‚å¿µ</span></a></h2><h3 id="_1-ä¸‰å¤§æ ¸å¿ƒå‡½æ•°" tabindex="-1"><a class="header-anchor" href="#_1-ä¸‰å¤§æ ¸å¿ƒå‡½æ•°"><span>1. ä¸‰å¤§æ ¸å¿ƒå‡½æ•°</span></a></h3><div class="language-typescript line-numbers-mode" data-highlighter="prismjs" data-ext="ts"><pre><code><span class="line"><span class="token comment">// ä¾èµ–æ”¶é›† - å½“è®¿é—®å“åº”å¼æ•°æ®æ—¶è°ƒç”¨</span></span>
<span class="line"><span class="token function">track</span><span class="token punctuation">(</span>target<span class="token operator">:</span> object<span class="token punctuation">,</span> type<span class="token operator">:</span> TrackOpTypes<span class="token punctuation">,</span> key<span class="token operator">:</span> <span class="token builtin">unknown</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token keyword">void</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">// ä¾èµ–è§¦å‘ - å½“å“åº”å¼æ•°æ®å˜åŒ–æ—¶è°ƒç”¨</span></span>
<span class="line"><span class="token function">trigger</span><span class="token punctuation">(</span>target<span class="token operator">:</span> object<span class="token punctuation">,</span> type<span class="token operator">:</span> TriggerOpTypes<span class="token punctuation">,</span> key<span class="token operator">?</span><span class="token operator">:</span> <span class="token builtin">unknown</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token keyword">void</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">// å‰¯ä½œç”¨å‡½æ•° - åˆ›å»ºå“åº”å¼å‰¯ä½œç”¨</span></span>
<span class="line"><span class="token generic-function"><span class="token function">effect</span><span class="token generic class-name"><span class="token operator">&lt;</span><span class="token constant">T</span> <span class="token operator">=</span> <span class="token builtin">any</span><span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span><span class="token function-variable function">fn</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token constant">T</span><span class="token punctuation">,</span> options<span class="token operator">?</span><span class="token operator">:</span> ReactiveEffectOptions<span class="token punctuation">)</span><span class="token operator">:</span> ReactiveEffectRunner<span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">&gt;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_2-æ ¸å¿ƒæ•°æ®ç»“æ„" tabindex="-1"><a class="header-anchor" href="#_2-æ ¸å¿ƒæ•°æ®ç»“æ„"><span>2. æ ¸å¿ƒæ•°æ®ç»“æ„</span></a></h3><div class="language-typescript line-numbers-mode" data-highlighter="prismjs" data-ext="ts"><pre><code><span class="line"><span class="token comment">// å…¨å±€ä¾èµ–æ˜ å°„è¡¨</span></span>
<span class="line"><span class="token keyword">export</span> <span class="token keyword">const</span> targetMap<span class="token operator">:</span> WeakMap<span class="token operator">&lt;</span>object<span class="token punctuation">,</span> Map<span class="token operator">&lt;</span><span class="token builtin">any</span><span class="token punctuation">,</span> Dep<span class="token operator">&gt;&gt;</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">WeakMap</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">// ä¾èµ–ç±»</span></span>
<span class="line"><span class="token keyword">export</span> <span class="token keyword">class</span> <span class="token class-name">Dep</span> <span class="token punctuation">{</span></span>
<span class="line">  version <span class="token operator">=</span> <span class="token number">0</span> <span class="token comment">// ç‰ˆæœ¬å·</span></span>
<span class="line">  activeLink<span class="token operator">?</span><span class="token operator">:</span> Link <span class="token comment">// å½“å‰æ´»è·ƒé“¾æ¥</span></span>
<span class="line">  subs<span class="token operator">?</span><span class="token operator">:</span> Link <span class="token comment">// è®¢é˜…è€…é“¾è¡¨</span></span>
<span class="line">  sc<span class="token operator">:</span> <span class="token builtin">number</span> <span class="token operator">=</span> <span class="token number">0</span> <span class="token comment">// è®¢é˜…è€…è®¡æ•°</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">// é“¾æ¥èŠ‚ç‚¹</span></span>
<span class="line"><span class="token keyword">export</span> <span class="token keyword">class</span> <span class="token class-name">Link</span> <span class="token punctuation">{</span></span>
<span class="line">  version<span class="token operator">:</span> <span class="token builtin">number</span> <span class="token comment">// ç‰ˆæœ¬å·</span></span>
<span class="line">  nextDep<span class="token operator">?</span><span class="token operator">:</span> Link <span class="token comment">// ä¾èµ–é“¾è¡¨æŒ‡é’ˆ</span></span>
<span class="line">  prevDep<span class="token operator">?</span><span class="token operator">:</span> Link <span class="token comment">// ä¾èµ–é“¾è¡¨æŒ‡é’ˆ</span></span>
<span class="line">  nextSub<span class="token operator">?</span><span class="token operator">:</span> Link <span class="token comment">// è®¢é˜…è€…é“¾è¡¨æŒ‡é’ˆ</span></span>
<span class="line">  prevSub<span class="token operator">?</span><span class="token operator">:</span> Link <span class="token comment">// è®¢é˜…è€…é“¾è¡¨æŒ‡é’ˆ</span></span>
<span class="line">  prevActiveLink<span class="token operator">?</span><span class="token operator">:</span> Link <span class="token comment">// å‰ä¸€ä¸ªæ´»è·ƒé“¾æ¥</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="ğŸ›ï¸-å“åº”å¼api" tabindex="-1"><a class="header-anchor" href="#ğŸ›ï¸-å“åº”å¼api"><span>ğŸ›ï¸ å“åº”å¼API</span></a></h2><h3 id="_1-reactive-æ·±åº¦å“åº”å¼" tabindex="-1"><a class="header-anchor" href="#_1-reactive-æ·±åº¦å“åº”å¼"><span>1. reactive() - æ·±åº¦å“åº”å¼</span></a></h3><div class="language-typescript line-numbers-mode" data-highlighter="prismjs" data-ext="ts"><pre><code><span class="line"><span class="token comment">// åˆ›å»ºæ·±åº¦å“åº”å¼å¯¹è±¡</span></span>
<span class="line"><span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token generic-function"><span class="token function">reactive</span><span class="token generic class-name"><span class="token operator">&lt;</span><span class="token constant">T</span> <span class="token keyword">extends</span> object<span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span>target<span class="token operator">:</span> <span class="token constant">T</span><span class="token punctuation">)</span><span class="token operator">:</span> Reactive<span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">&gt;</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">// ä½¿ç”¨ç¤ºä¾‹</span></span>
<span class="line"><span class="token keyword">const</span> state <span class="token operator">=</span> <span class="token function">reactive</span><span class="token punctuation">(</span><span class="token punctuation">{</span></span>
<span class="line">  count<span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span></span>
<span class="line">  user<span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="line">    name<span class="token operator">:</span> <span class="token string">&#39;Vue&#39;</span><span class="token punctuation">,</span></span>
<span class="line">    age<span class="token operator">:</span> <span class="token number">25</span><span class="token punctuation">,</span></span>
<span class="line">  <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line"><span class="token punctuation">}</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">// æ‰€æœ‰åµŒå¥—å±æ€§éƒ½æ˜¯å“åº”å¼çš„</span></span>
<span class="line">state<span class="token punctuation">.</span>count<span class="token operator">++</span> <span class="token comment">// è§¦å‘æ›´æ–°</span></span>
<span class="line">state<span class="token punctuation">.</span>user<span class="token punctuation">.</span>name <span class="token operator">=</span> <span class="token string">&#39;Vue3&#39;</span> <span class="token comment">// è§¦å‘æ›´æ–°</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_2-ref-å“åº”å¼å¼•ç”¨" tabindex="-1"><a class="header-anchor" href="#_2-ref-å“åº”å¼å¼•ç”¨"><span>2. ref() - å“åº”å¼å¼•ç”¨</span></a></h3><div class="language-typescript line-numbers-mode" data-highlighter="prismjs" data-ext="ts"><pre><code><span class="line"><span class="token comment">// åˆ›å»ºå“åº”å¼å¼•ç”¨</span></span>
<span class="line"><span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token generic-function"><span class="token function">ref</span><span class="token generic class-name"><span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span>value<span class="token operator">:</span> <span class="token constant">T</span><span class="token punctuation">)</span><span class="token operator">:</span> Ref<span class="token operator">&lt;</span>UnwrapRef<span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">&gt;&gt;</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">// RefImplå®ç°</span></span>
<span class="line"><span class="token keyword">class</span> <span class="token class-name">RefImpl<span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">&gt;</span></span> <span class="token punctuation">{</span></span>
<span class="line">  _value<span class="token operator">:</span> <span class="token constant">T</span></span>
<span class="line">  <span class="token keyword">private</span> _rawValue<span class="token operator">:</span> <span class="token constant">T</span></span>
<span class="line">  dep<span class="token operator">:</span> Dep <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Dep</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line">  <span class="token keyword">get</span> <span class="token function">value</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">this</span><span class="token punctuation">.</span>dep<span class="token punctuation">.</span><span class="token function">track</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// è®¿é—®æ—¶æ”¶é›†ä¾èµ–</span></span>
<span class="line">    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_value</span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">  <span class="token keyword">set</span> <span class="token function">value</span><span class="token punctuation">(</span>newValue<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">hasChanged</span><span class="token punctuation">(</span>newValue<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_rawValue<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">      <span class="token keyword">this</span><span class="token punctuation">.</span>_rawValue <span class="token operator">=</span> newValue</span>
<span class="line">      <span class="token keyword">this</span><span class="token punctuation">.</span>_value <span class="token operator">=</span> <span class="token function">toReactive</span><span class="token punctuation">(</span>newValue<span class="token punctuation">)</span></span>
<span class="line">      <span class="token keyword">this</span><span class="token punctuation">.</span>dep<span class="token punctuation">.</span><span class="token function">trigger</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// å˜åŒ–æ—¶è§¦å‘æ›´æ–°</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_3-computed-è®¡ç®—å±æ€§" tabindex="-1"><a class="header-anchor" href="#_3-computed-è®¡ç®—å±æ€§"><span>3. computed() - è®¡ç®—å±æ€§</span></a></h3><div class="language-typescript line-numbers-mode" data-highlighter="prismjs" data-ext="ts"><pre><code><span class="line"><span class="token comment">// åˆ›å»ºè®¡ç®—å±æ€§</span></span>
<span class="line"><span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token generic-function"><span class="token function">computed</span><span class="token generic class-name"><span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span></span>
<span class="line">  getter<span class="token operator">:</span> ComputedGetter<span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">&gt;</span><span class="token punctuation">,</span></span>
<span class="line">  debugOptions<span class="token operator">?</span><span class="token operator">:</span> DebuggerOptions<span class="token punctuation">,</span></span>
<span class="line"><span class="token punctuation">)</span><span class="token operator">:</span> ComputedRef<span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">&gt;</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">// ComputedRefImplå®ç°</span></span>
<span class="line"><span class="token keyword">class</span> <span class="token class-name">ComputedRefImpl<span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">&gt;</span></span> <span class="token keyword">implements</span> <span class="token class-name">Subscriber</span> <span class="token punctuation">{</span></span>
<span class="line">  _value<span class="token operator">:</span> <span class="token builtin">any</span> <span class="token operator">=</span> <span class="token keyword">undefined</span></span>
<span class="line">  dep<span class="token operator">:</span> Dep <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Dep</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span></span>
<span class="line">  flags<span class="token operator">:</span> EffectFlags <span class="token operator">=</span> EffectFlags<span class="token punctuation">.</span><span class="token constant">DIRTY</span></span>
<span class="line"></span>
<span class="line">  <span class="token keyword">get</span> <span class="token function">value</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token constant">T</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">this</span><span class="token punctuation">.</span>dep<span class="token punctuation">.</span><span class="token function">track</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token function">refreshComputed</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span> <span class="token comment">// åªåœ¨éœ€è¦æ—¶é‡æ–°è®¡ç®—</span></span>
<span class="line">    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_value</span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">  <span class="token function">notify</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token boolean">true</span> <span class="token operator">|</span> <span class="token keyword">void</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">this</span><span class="token punctuation">.</span>flags <span class="token operator">|=</span> EffectFlags<span class="token punctuation">.</span><span class="token constant">DIRTY</span> <span class="token comment">// æ ‡è®°ä¸ºè„</span></span>
<span class="line">    <span class="token function">batch</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span> <span class="token comment">// æ‰¹é‡æ›´æ–°</span></span>
<span class="line">    <span class="token keyword">return</span> <span class="token boolean">true</span></span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_4-watch-ä¾¦å¬å™¨" tabindex="-1"><a class="header-anchor" href="#_4-watch-ä¾¦å¬å™¨"><span>4. watch() - ä¾¦å¬å™¨</span></a></h3><div class="language-typescript line-numbers-mode" data-highlighter="prismjs" data-ext="ts"><pre><code><span class="line"><span class="token comment">// åˆ›å»ºä¾¦å¬å™¨</span></span>
<span class="line"><span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token generic-function"><span class="token function">watch</span><span class="token generic class-name"><span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span></span>
<span class="line">  source<span class="token operator">:</span> WatchSource<span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">&gt;</span><span class="token punctuation">,</span></span>
<span class="line">  callback<span class="token operator">:</span> WatchCallback<span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">&gt;</span><span class="token punctuation">,</span></span>
<span class="line">  options<span class="token operator">?</span><span class="token operator">:</span> WatchOptions<span class="token punctuation">,</span></span>
<span class="line"><span class="token punctuation">)</span><span class="token operator">:</span> WatchStopHandle</span>
<span class="line"></span>
<span class="line"><span class="token comment">// ä½¿ç”¨ç¤ºä¾‹</span></span>
<span class="line"><span class="token function">watch</span><span class="token punctuation">(</span></span>
<span class="line">  <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> state<span class="token punctuation">.</span>count<span class="token punctuation">,</span></span>
<span class="line">  <span class="token punctuation">(</span>newValue<span class="token punctuation">,</span> oldValue<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">\`</span><span class="token string">count changed: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">\${</span>oldValue<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> -&gt; </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">\${</span>newValue<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">\`</span></span><span class="token punctuation">)</span></span>
<span class="line">  <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">  <span class="token punctuation">{</span> immediate<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> deep<span class="token operator">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line"><span class="token punctuation">)</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="ğŸ”§-ä¾èµ–è¿½è¸ªæœºåˆ¶" tabindex="-1"><a class="header-anchor" href="#ğŸ”§-ä¾èµ–è¿½è¸ªæœºåˆ¶"><span>ğŸ”§ ä¾èµ–è¿½è¸ªæœºåˆ¶</span></a></h2><h3 id="_1-ä¾èµ–æ”¶é›†æµç¨‹" tabindex="-1"><a class="header-anchor" href="#_1-ä¾èµ–æ”¶é›†æµç¨‹"><span>1. ä¾èµ–æ”¶é›†æµç¨‹</span></a></h3><div class="language-typescript line-numbers-mode" data-highlighter="prismjs" data-ext="ts"><pre><code><span class="line"><span class="token comment">// ä¾èµ–æ”¶é›†å®Œæ•´æµç¨‹</span></span>
<span class="line"><span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">track</span><span class="token punctuation">(</span>target<span class="token operator">:</span> object<span class="token punctuation">,</span> type<span class="token operator">:</span> TrackOpTypes<span class="token punctuation">,</span> key<span class="token operator">:</span> <span class="token builtin">unknown</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token keyword">void</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token keyword">if</span> <span class="token punctuation">(</span>shouldTrack <span class="token operator">&amp;&amp;</span> activeSub<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token comment">// 1. è·å–æˆ–åˆ›å»ºtargetçš„ä¾èµ–æ˜ å°„</span></span>
<span class="line">    <span class="token keyword">let</span> depsMap <span class="token operator">=</span> targetMap<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>target<span class="token punctuation">)</span></span>
<span class="line">    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>depsMap<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">      targetMap<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span>target<span class="token punctuation">,</span> <span class="token punctuation">(</span>depsMap <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Map</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">    <span class="token comment">// 2. è·å–æˆ–åˆ›å»ºkeyçš„ä¾èµ–</span></span>
<span class="line">    <span class="token keyword">let</span> dep <span class="token operator">=</span> depsMap<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span></span>
<span class="line">    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>dep<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">      depsMap<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> <span class="token punctuation">(</span>dep <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Dep</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line">      dep<span class="token punctuation">.</span>map <span class="token operator">=</span> depsMap</span>
<span class="line">      dep<span class="token punctuation">.</span>key <span class="token operator">=</span> key</span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">    <span class="token comment">// 3. å»ºç«‹ä¾èµ–å…³ç³»</span></span>
<span class="line">    dep<span class="token punctuation">.</span><span class="token function">track</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_2-ä¾èµ–è§¦å‘æµç¨‹" tabindex="-1"><a class="header-anchor" href="#_2-ä¾èµ–è§¦å‘æµç¨‹"><span>2. ä¾èµ–è§¦å‘æµç¨‹</span></a></h3><div class="language-typescript line-numbers-mode" data-highlighter="prismjs" data-ext="ts"><pre><code><span class="line"><span class="token comment">// ä¾èµ–è§¦å‘å®Œæ•´æµç¨‹</span></span>
<span class="line"><span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">trigger</span><span class="token punctuation">(</span></span>
<span class="line">  target<span class="token operator">:</span> object<span class="token punctuation">,</span></span>
<span class="line">  type<span class="token operator">:</span> TriggerOpTypes<span class="token punctuation">,</span></span>
<span class="line">  key<span class="token operator">?</span><span class="token operator">:</span> <span class="token builtin">unknown</span><span class="token punctuation">,</span></span>
<span class="line">  newValue<span class="token operator">?</span><span class="token operator">:</span> <span class="token builtin">unknown</span><span class="token punctuation">,</span></span>
<span class="line">  oldValue<span class="token operator">?</span><span class="token operator">:</span> <span class="token builtin">unknown</span><span class="token punctuation">,</span></span>
<span class="line"><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token keyword">void</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token keyword">const</span> depsMap <span class="token operator">=</span> targetMap<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>target<span class="token punctuation">)</span></span>
<span class="line">  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>depsMap<span class="token punctuation">)</span> <span class="token keyword">return</span></span>
<span class="line"></span>
<span class="line">  <span class="token keyword">const</span> <span class="token function-variable function">run</span> <span class="token operator">=</span> <span class="token punctuation">(</span>dep<span class="token operator">:</span> Dep <span class="token operator">|</span> <span class="token keyword">undefined</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">if</span> <span class="token punctuation">(</span>dep<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">      dep<span class="token punctuation">.</span><span class="token function">trigger</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">  <span class="token function">startBatch</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line">  <span class="token keyword">if</span> <span class="token punctuation">(</span>type <span class="token operator">===</span> TriggerOpTypes<span class="token punctuation">.</span><span class="token constant">CLEAR</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token comment">// æ¸…ç©ºæ“ä½œï¼šè§¦å‘æ‰€æœ‰ä¾èµ–</span></span>
<span class="line">    depsMap<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span>run<span class="token punctuation">)</span></span>
<span class="line">  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token comment">// æ™®é€šå±æ€§å˜åŒ–</span></span>
<span class="line">    <span class="token keyword">if</span> <span class="token punctuation">(</span>key <span class="token operator">!==</span> <span class="token keyword">void</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">      <span class="token function">run</span><span class="token punctuation">(</span>depsMap<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">    <span class="token comment">// ç‰¹æ®Šé”®å€¼å¤„ç†</span></span>
<span class="line">    <span class="token keyword">switch</span> <span class="token punctuation">(</span>type<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">      <span class="token keyword">case</span> TriggerOpTypes<span class="token punctuation">.</span><span class="token constant">ADD</span><span class="token operator">:</span></span>
<span class="line">        <span class="token function">run</span><span class="token punctuation">(</span>depsMap<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token constant">ITERATE_KEY</span><span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line">        <span class="token keyword">break</span></span>
<span class="line">      <span class="token keyword">case</span> TriggerOpTypes<span class="token punctuation">.</span><span class="token constant">DELETE</span><span class="token operator">:</span></span>
<span class="line">        <span class="token function">run</span><span class="token punctuation">(</span>depsMap<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token constant">ITERATE_KEY</span><span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line">        <span class="token keyword">break</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">  <span class="token function">endBatch</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="ğŸ¯-effectç”Ÿå‘½å‘¨æœŸ" tabindex="-1"><a class="header-anchor" href="#ğŸ¯-effectç”Ÿå‘½å‘¨æœŸ"><span>ğŸ¯ Effectç”Ÿå‘½å‘¨æœŸ</span></a></h2><h3 id="_1-effectè¿è¡Œæµç¨‹" tabindex="-1"><a class="header-anchor" href="#_1-effectè¿è¡Œæµç¨‹"><span>1. Effectè¿è¡Œæµç¨‹</span></a></h3><div class="language-typescript line-numbers-mode" data-highlighter="prismjs" data-ext="ts"><pre><code><span class="line"><span class="token keyword">class</span> <span class="token class-name">ReactiveEffect<span class="token operator">&lt;</span><span class="token constant">T</span> <span class="token operator">=</span> <span class="token builtin">any</span><span class="token operator">&gt;</span></span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token constant">T</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>flags <span class="token operator">&amp;</span> EffectFlags<span class="token punctuation">.</span><span class="token constant">ACTIVE</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">      <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">fn</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">    <span class="token keyword">this</span><span class="token punctuation">.</span>flags <span class="token operator">|=</span> EffectFlags<span class="token punctuation">.</span><span class="token constant">RUNNING</span></span>
<span class="line"></span>
<span class="line">    <span class="token comment">// 1. æ¸…ç†ä¹‹å‰çš„ä¾èµ–</span></span>
<span class="line">    <span class="token function">cleanupEffect</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line">    <span class="token comment">// 2. å‡†å¤‡ä¾èµ–è¿½è¸ª</span></span>
<span class="line">    <span class="token function">prepareDeps</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line">    <span class="token comment">// 3. è®¾ç½®å½“å‰æ´»è·ƒçš„effect</span></span>
<span class="line">    <span class="token keyword">const</span> prevEffect <span class="token operator">=</span> activeSub</span>
<span class="line">    <span class="token keyword">const</span> prevShouldTrack <span class="token operator">=</span> shouldTrack</span>
<span class="line">    activeSub <span class="token operator">=</span> <span class="token keyword">this</span></span>
<span class="line">    shouldTrack <span class="token operator">=</span> <span class="token boolean">true</span></span>
<span class="line"></span>
<span class="line">    <span class="token keyword">try</span> <span class="token punctuation">{</span></span>
<span class="line">      <span class="token comment">// 4. æ‰§è¡Œeffectå‡½æ•°ï¼ˆæœŸé—´ä¼šæ”¶é›†ä¾èµ–ï¼‰</span></span>
<span class="line">      <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">fn</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token punctuation">}</span> <span class="token keyword">finally</span> <span class="token punctuation">{</span></span>
<span class="line">      <span class="token comment">// 5. æ¸…ç†æœªä½¿ç”¨çš„ä¾èµ–</span></span>
<span class="line">      <span class="token function">cleanupDeps</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line">      <span class="token comment">// 6. æ¢å¤ä¹‹å‰çš„ä¸Šä¸‹æ–‡</span></span>
<span class="line">      activeSub <span class="token operator">=</span> prevEffect</span>
<span class="line">      shouldTrack <span class="token operator">=</span> prevShouldTrack</span>
<span class="line">      <span class="token keyword">this</span><span class="token punctuation">.</span>flags <span class="token operator">&amp;=</span> <span class="token operator">~</span>EffectFlags<span class="token punctuation">.</span><span class="token constant">RUNNING</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_2-ä¾èµ–æ¸…ç†æœºåˆ¶" tabindex="-1"><a class="header-anchor" href="#_2-ä¾èµ–æ¸…ç†æœºåˆ¶"><span>2. ä¾èµ–æ¸…ç†æœºåˆ¶</span></a></h3><div class="language-typescript line-numbers-mode" data-highlighter="prismjs" data-ext="ts"><pre><code><span class="line"><span class="token keyword">function</span> <span class="token function">cleanupDeps</span><span class="token punctuation">(</span>sub<span class="token operator">:</span> Subscriber<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token keyword">let</span> head</span>
<span class="line">  <span class="token keyword">let</span> tail <span class="token operator">=</span> sub<span class="token punctuation">.</span>depsTail</span>
<span class="line">  <span class="token keyword">let</span> link <span class="token operator">=</span> tail</span>
<span class="line"></span>
<span class="line">  <span class="token keyword">while</span> <span class="token punctuation">(</span>link<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">const</span> prev <span class="token operator">=</span> link<span class="token punctuation">.</span>prevDep</span>
<span class="line">    <span class="token keyword">if</span> <span class="token punctuation">(</span>link<span class="token punctuation">.</span>version <span class="token operator">===</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">      <span class="token comment">// æœªä½¿ç”¨çš„ä¾èµ–ï¼šä»é“¾è¡¨ä¸­ç§»é™¤</span></span>
<span class="line">      <span class="token keyword">if</span> <span class="token punctuation">(</span>link <span class="token operator">===</span> tail<span class="token punctuation">)</span> tail <span class="token operator">=</span> prev</span>
<span class="line">      <span class="token function">removeSub</span><span class="token punctuation">(</span>link<span class="token punctuation">)</span></span>
<span class="line">      <span class="token function">removeDep</span><span class="token punctuation">(</span>link<span class="token punctuation">)</span></span>
<span class="line">    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span></span>
<span class="line">      <span class="token comment">// ä½¿ç”¨çš„ä¾èµ–ï¼šä¿ç•™</span></span>
<span class="line">      head <span class="token operator">=</span> link</span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">    <span class="token comment">// æ¢å¤ä¹‹å‰çš„æ´»è·ƒé“¾æ¥</span></span>
<span class="line">    link<span class="token punctuation">.</span>dep<span class="token punctuation">.</span>activeLink <span class="token operator">=</span> link<span class="token punctuation">.</span>prevActiveLink</span>
<span class="line">    link<span class="token punctuation">.</span>prevActiveLink <span class="token operator">=</span> <span class="token keyword">undefined</span></span>
<span class="line">    link <span class="token operator">=</span> prev</span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">  <span class="token comment">// æ›´æ–°å¤´éƒ¨å’Œå°¾éƒ¨æŒ‡é’ˆ</span></span>
<span class="line">  sub<span class="token punctuation">.</span>deps <span class="token operator">=</span> head</span>
<span class="line">  sub<span class="token punctuation">.</span>depsTail <span class="token operator">=</span> tail</span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="ğŸ›ï¸-ç‰ˆæœ¬æ§åˆ¶ä¼˜åŒ–" tabindex="-1"><a class="header-anchor" href="#ğŸ›ï¸-ç‰ˆæœ¬æ§åˆ¶ä¼˜åŒ–"><span>ğŸ›ï¸ ç‰ˆæœ¬æ§åˆ¶ä¼˜åŒ–</span></a></h2><h3 id="_1-ç‰ˆæœ¬å·æœºåˆ¶" tabindex="-1"><a class="header-anchor" href="#_1-ç‰ˆæœ¬å·æœºåˆ¶"><span>1. ç‰ˆæœ¬å·æœºåˆ¶</span></a></h3><div class="language-typescript line-numbers-mode" data-highlighter="prismjs" data-ext="ts"><pre><code><span class="line"><span class="token comment">// å…¨å±€ç‰ˆæœ¬å·</span></span>
<span class="line"><span class="token keyword">export</span> <span class="token keyword">let</span> globalVersion <span class="token operator">=</span> <span class="token number">0</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">// ä¾èµ–ç‰ˆæœ¬å·</span></span>
<span class="line"><span class="token keyword">class</span> <span class="token class-name">Dep</span> <span class="token punctuation">{</span></span>
<span class="line">  version <span class="token operator">=</span> <span class="token number">0</span></span>
<span class="line"></span>
<span class="line">  <span class="token function">trigger</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">this</span><span class="token punctuation">.</span>version<span class="token operator">++</span> <span class="token comment">// æ¯æ¬¡è§¦å‘æ—¶é€’å¢</span></span>
<span class="line">    globalVersion<span class="token operator">++</span> <span class="token comment">// å…¨å±€ç‰ˆæœ¬å·ä¹Ÿé€’å¢</span></span>
<span class="line">    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">notify</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">// é“¾æ¥ç‰ˆæœ¬å·</span></span>
<span class="line"><span class="token keyword">class</span> <span class="token class-name">Link</span> <span class="token punctuation">{</span></span>
<span class="line">  version<span class="token operator">:</span> <span class="token builtin">number</span></span>
<span class="line"></span>
<span class="line">  <span class="token function">constructor</span><span class="token punctuation">(</span>sub<span class="token operator">:</span> Subscriber<span class="token punctuation">,</span> dep<span class="token operator">:</span> Dep<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">this</span><span class="token punctuation">.</span>version <span class="token operator">=</span> dep<span class="token punctuation">.</span>version <span class="token comment">// åˆå§‹åŒ–ä¸ºdepçš„ç‰ˆæœ¬å·</span></span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_2-å¿«é€Ÿè·¯å¾„æ£€æŸ¥" tabindex="-1"><a class="header-anchor" href="#_2-å¿«é€Ÿè·¯å¾„æ£€æŸ¥"><span>2. å¿«é€Ÿè·¯å¾„æ£€æŸ¥</span></a></h3><div class="language-typescript line-numbers-mode" data-highlighter="prismjs" data-ext="ts"><pre><code><span class="line"><span class="token keyword">function</span> <span class="token function">isDirty</span><span class="token punctuation">(</span>sub<span class="token operator">:</span> Subscriber<span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">boolean</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> link <span class="token operator">=</span> sub<span class="token punctuation">.</span>deps<span class="token punctuation">;</span> link<span class="token punctuation">;</span> link <span class="token operator">=</span> link<span class="token punctuation">.</span>nextDep<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token comment">// æ£€æŸ¥ç‰ˆæœ¬å·æ˜¯å¦åŒ¹é…</span></span>
<span class="line">    <span class="token keyword">if</span> <span class="token punctuation">(</span>link<span class="token punctuation">.</span>dep<span class="token punctuation">.</span>version <span class="token operator">!==</span> link<span class="token punctuation">.</span>version<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">      <span class="token keyword">return</span> <span class="token boolean">true</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">    <span class="token comment">// æ£€æŸ¥computedä¾èµ–</span></span>
<span class="line">    <span class="token keyword">if</span> <span class="token punctuation">(</span>link<span class="token punctuation">.</span>dep<span class="token punctuation">.</span>computed <span class="token operator">&amp;&amp;</span> <span class="token function">refreshComputed</span><span class="token punctuation">(</span>link<span class="token punctuation">.</span>dep<span class="token punctuation">.</span>computed<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">      <span class="token keyword">return</span> <span class="token boolean">true</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line">  <span class="token keyword">return</span> <span class="token boolean">false</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="ğŸ“¦-æ‰¹é‡æ›´æ–°æœºåˆ¶" tabindex="-1"><a class="header-anchor" href="#ğŸ“¦-æ‰¹é‡æ›´æ–°æœºåˆ¶"><span>ğŸ“¦ æ‰¹é‡æ›´æ–°æœºåˆ¶</span></a></h2><h3 id="_1-æ‰¹é‡å¤„ç†" tabindex="-1"><a class="header-anchor" href="#_1-æ‰¹é‡å¤„ç†"><span>1. æ‰¹é‡å¤„ç†</span></a></h3><div class="language-typescript line-numbers-mode" data-highlighter="prismjs" data-ext="ts"><pre><code><span class="line"><span class="token comment">// æ‰¹é‡æ·±åº¦</span></span>
<span class="line"><span class="token keyword">let</span> batchDepth <span class="token operator">=</span> <span class="token number">0</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">// å¼€å§‹æ‰¹é‡</span></span>
<span class="line"><span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">startBatch</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token keyword">void</span> <span class="token punctuation">{</span></span>
<span class="line">  batchDepth<span class="token operator">++</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">// ç»“æŸæ‰¹é‡</span></span>
<span class="line"><span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">endBatch</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token keyword">void</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">--</span>batchDepth <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">return</span></span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">  <span class="token comment">// æ‰§è¡Œé˜Ÿåˆ—ä¸­çš„ä»»åŠ¡</span></span>
<span class="line">  <span class="token keyword">let</span> error<span class="token operator">:</span> <span class="token builtin">unknown</span></span>
<span class="line">  <span class="token keyword">while</span> <span class="token punctuation">(</span>batchedSub<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">let</span> e<span class="token operator">:</span> Subscriber <span class="token operator">|</span> <span class="token keyword">undefined</span> <span class="token operator">=</span> batchedSub</span>
<span class="line">    batchedSub <span class="token operator">=</span> <span class="token keyword">undefined</span></span>
<span class="line">    <span class="token keyword">while</span> <span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">      <span class="token keyword">const</span> next<span class="token operator">:</span> Subscriber <span class="token operator">|</span> <span class="token keyword">undefined</span> <span class="token operator">=</span> e<span class="token punctuation">.</span>next</span>
<span class="line">      e<span class="token punctuation">.</span>next <span class="token operator">=</span> <span class="token keyword">undefined</span></span>
<span class="line">      e<span class="token punctuation">.</span>flags <span class="token operator">&amp;=</span> <span class="token operator">~</span>EffectFlags<span class="token punctuation">.</span><span class="token constant">NOTIFIED</span></span>
<span class="line">      <span class="token keyword">if</span> <span class="token punctuation">(</span>e<span class="token punctuation">.</span>flags <span class="token operator">&amp;</span> EffectFlags<span class="token punctuation">.</span><span class="token constant">ACTIVE</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token keyword">try</span> <span class="token punctuation">{</span></span>
<span class="line">          <span class="token punctuation">;</span><span class="token punctuation">(</span>e <span class="token keyword">as</span> ReactiveEffect<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">trigger</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">          <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>error<span class="token punctuation">)</span> error <span class="token operator">=</span> err</span>
<span class="line">        <span class="token punctuation">}</span></span>
<span class="line">      <span class="token punctuation">}</span></span>
<span class="line">      e <span class="token operator">=</span> next</span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">  <span class="token keyword">if</span> <span class="token punctuation">(</span>error<span class="token punctuation">)</span> <span class="token keyword">throw</span> error</span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_2-ä»»åŠ¡é˜Ÿåˆ—" tabindex="-1"><a class="header-anchor" href="#_2-ä»»åŠ¡é˜Ÿåˆ—"><span>2. ä»»åŠ¡é˜Ÿåˆ—</span></a></h3><div class="language-typescript line-numbers-mode" data-highlighter="prismjs" data-ext="ts"><pre><code><span class="line"><span class="token comment">// æ‰¹é‡ä»»åŠ¡</span></span>
<span class="line"><span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">batch</span><span class="token punctuation">(</span>sub<span class="token operator">:</span> Subscriber<span class="token punctuation">,</span> isComputed <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token keyword">void</span> <span class="token punctuation">{</span></span>
<span class="line">  sub<span class="token punctuation">.</span>flags <span class="token operator">|=</span> EffectFlags<span class="token punctuation">.</span><span class="token constant">NOTIFIED</span></span>
<span class="line"></span>
<span class="line">  <span class="token keyword">if</span> <span class="token punctuation">(</span>isComputed<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token comment">// computed effectï¼šæ·»åŠ åˆ°computedé˜Ÿåˆ—</span></span>
<span class="line">    sub<span class="token punctuation">.</span>next <span class="token operator">=</span> batchedComputed</span>
<span class="line">    batchedComputed <span class="token operator">=</span> sub</span>
<span class="line">  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token comment">// æ™®é€šeffectï¼šæ·»åŠ åˆ°æ™®é€šé˜Ÿåˆ—</span></span>
<span class="line">    sub<span class="token punctuation">.</span>next <span class="token operator">=</span> batchedSub</span>
<span class="line">    batchedSub <span class="token operator">=</span> sub</span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="ğŸ”§-é›†åˆç±»å‹æ”¯æŒ" tabindex="-1"><a class="header-anchor" href="#ğŸ”§-é›†åˆç±»å‹æ”¯æŒ"><span>ğŸ”§ é›†åˆç±»å‹æ”¯æŒ</span></a></h2><h3 id="_1-é›†åˆå¤„ç†å™¨" tabindex="-1"><a class="header-anchor" href="#_1-é›†åˆå¤„ç†å™¨"><span>1. é›†åˆå¤„ç†å™¨</span></a></h3><div class="language-typescript line-numbers-mode" data-highlighter="prismjs" data-ext="ts"><pre><code><span class="line"><span class="token comment">// é›†åˆç±»å‹å¤„ç†å™¨</span></span>
<span class="line"><span class="token keyword">const</span> mutableCollectionHandlers<span class="token operator">:</span> ProxyHandler<span class="token operator">&lt;</span>CollectionTypes<span class="token operator">&gt;</span> <span class="token operator">=</span> <span class="token punctuation">{</span></span>
<span class="line">  get<span class="token operator">:</span> <span class="token function">createInstrumentationGetter</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">,</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">// åˆ›å»ºé›†åˆæ–¹æ³•é‡å†™</span></span>
<span class="line"><span class="token keyword">function</span> <span class="token function">createInstrumentations</span><span class="token punctuation">(</span><span class="token keyword">readonly</span><span class="token operator">:</span> <span class="token builtin">boolean</span><span class="token punctuation">,</span> shallow<span class="token operator">:</span> <span class="token builtin">boolean</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token keyword">return</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token function">get</span><span class="token punctuation">(</span>key<span class="token operator">:</span> <span class="token builtin">unknown</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">      <span class="token keyword">return</span> <span class="token function">get</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> key<span class="token punctuation">,</span> <span class="token keyword">readonly</span><span class="token punctuation">,</span> shallow<span class="token punctuation">)</span></span>
<span class="line">    <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token keyword">get</span> <span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">      <span class="token keyword">return</span> <span class="token function">size</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> <span class="token keyword">readonly</span><span class="token punctuation">,</span> shallow<span class="token punctuation">)</span></span>
<span class="line">    <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token function">has</span><span class="token punctuation">(</span>key<span class="token operator">:</span> <span class="token builtin">unknown</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">      <span class="token keyword">return</span> <span class="token function">has</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> key<span class="token punctuation">,</span> <span class="token keyword">readonly</span><span class="token punctuation">,</span> shallow<span class="token punctuation">)</span></span>
<span class="line">    <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token function">add</span><span class="token punctuation">(</span>value<span class="token operator">:</span> <span class="token builtin">unknown</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">      <span class="token keyword">return</span> <span class="token function">add</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> value<span class="token punctuation">,</span> <span class="token keyword">readonly</span><span class="token punctuation">,</span> shallow<span class="token punctuation">)</span></span>
<span class="line">    <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token function">set</span><span class="token punctuation">(</span>key<span class="token operator">:</span> <span class="token builtin">unknown</span><span class="token punctuation">,</span> value<span class="token operator">:</span> <span class="token builtin">unknown</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">      <span class="token keyword">return</span> <span class="token function">set</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> key<span class="token punctuation">,</span> value<span class="token punctuation">,</span> <span class="token keyword">readonly</span><span class="token punctuation">,</span> shallow<span class="token punctuation">)</span></span>
<span class="line">    <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token keyword">delete</span><span class="token punctuation">(</span>key<span class="token operator">:</span> <span class="token builtin">unknown</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">      <span class="token keyword">return</span> <span class="token function">deleteEntry</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> key<span class="token punctuation">,</span> <span class="token keyword">readonly</span><span class="token punctuation">,</span> shallow<span class="token punctuation">)</span></span>
<span class="line">    <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token function">clear</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">      <span class="token keyword">return</span> <span class="token function">clear</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> <span class="token keyword">readonly</span><span class="token punctuation">,</span> shallow<span class="token punctuation">)</span></span>
<span class="line">    <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token function">forEach</span><span class="token punctuation">(</span>callback<span class="token operator">:</span> <span class="token builtin">Function</span><span class="token punctuation">,</span> thisArg<span class="token operator">?</span><span class="token operator">:</span> <span class="token builtin">unknown</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">      <span class="token keyword">return</span> <span class="token function">forEach</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> callback<span class="token punctuation">,</span> thisArg<span class="token punctuation">,</span> <span class="token keyword">readonly</span><span class="token punctuation">,</span> shallow<span class="token punctuation">)</span></span>
<span class="line">    <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_2-ç‰¹æ®Šé”®å€¼å¤„ç†" tabindex="-1"><a class="header-anchor" href="#_2-ç‰¹æ®Šé”®å€¼å¤„ç†"><span>2. ç‰¹æ®Šé”®å€¼å¤„ç†</span></a></h3><div class="language-typescript line-numbers-mode" data-highlighter="prismjs" data-ext="ts"><pre><code><span class="line"><span class="token comment">// ç‰¹æ®Šé”®å€¼</span></span>
<span class="line"><span class="token keyword">export</span> <span class="token keyword">const</span> <span class="token constant">ITERATE_KEY</span><span class="token operator">:</span> unique <span class="token builtin">symbol</span> <span class="token operator">=</span> <span class="token function">Symbol</span><span class="token punctuation">(</span></span>
<span class="line">  __DEV__ <span class="token operator">?</span> <span class="token string">&#39;Object iterate&#39;</span> <span class="token operator">:</span> <span class="token string">&#39;&#39;</span><span class="token punctuation">,</span></span>
<span class="line"><span class="token punctuation">)</span></span>
<span class="line"><span class="token keyword">export</span> <span class="token keyword">const</span> <span class="token constant">MAP_KEY_ITERATE_KEY</span><span class="token operator">:</span> unique <span class="token builtin">symbol</span> <span class="token operator">=</span> <span class="token function">Symbol</span><span class="token punctuation">(</span></span>
<span class="line">  __DEV__ <span class="token operator">?</span> <span class="token string">&#39;Map keys iterate&#39;</span> <span class="token operator">:</span> <span class="token string">&#39;&#39;</span><span class="token punctuation">,</span></span>
<span class="line"><span class="token punctuation">)</span></span>
<span class="line"><span class="token keyword">export</span> <span class="token keyword">const</span> <span class="token constant">ARRAY_ITERATE_KEY</span><span class="token operator">:</span> unique <span class="token builtin">symbol</span> <span class="token operator">=</span> <span class="token function">Symbol</span><span class="token punctuation">(</span></span>
<span class="line">  __DEV__ <span class="token operator">?</span> <span class="token string">&#39;Array iterate&#39;</span> <span class="token operator">:</span> <span class="token string">&#39;&#39;</span><span class="token punctuation">,</span></span>
<span class="line"><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">// æ“ä½œç±»å‹</span></span>
<span class="line"><span class="token keyword">export</span> <span class="token keyword">enum</span> TrackOpTypes <span class="token punctuation">{</span></span>
<span class="line">  <span class="token constant">GET</span> <span class="token operator">=</span> <span class="token string">&#39;get&#39;</span><span class="token punctuation">,</span></span>
<span class="line">  <span class="token constant">HAS</span> <span class="token operator">=</span> <span class="token string">&#39;has&#39;</span><span class="token punctuation">,</span></span>
<span class="line">  <span class="token constant">ITERATE</span> <span class="token operator">=</span> <span class="token string">&#39;iterate&#39;</span><span class="token punctuation">,</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">export</span> <span class="token keyword">enum</span> TriggerOpTypes <span class="token punctuation">{</span></span>
<span class="line">  <span class="token constant">SET</span> <span class="token operator">=</span> <span class="token string">&#39;set&#39;</span><span class="token punctuation">,</span></span>
<span class="line">  <span class="token constant">ADD</span> <span class="token operator">=</span> <span class="token string">&#39;add&#39;</span><span class="token punctuation">,</span></span>
<span class="line">  <span class="token constant">DELETE</span> <span class="token operator">=</span> <span class="token string">&#39;delete&#39;</span><span class="token punctuation">,</span></span>
<span class="line">  <span class="token constant">CLEAR</span> <span class="token operator">=</span> <span class="token string">&#39;clear&#39;</span><span class="token punctuation">,</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="ğŸ›-è°ƒè¯•æ”¯æŒ" tabindex="-1"><a class="header-anchor" href="#ğŸ›-è°ƒè¯•æ”¯æŒ"><span>ğŸ› è°ƒè¯•æ”¯æŒ</span></a></h2><h3 id="_1-å¼€å‘é’©å­" tabindex="-1"><a class="header-anchor" href="#_1-å¼€å‘é’©å­"><span>1. å¼€å‘é’©å­</span></a></h3><div class="language-typescript line-numbers-mode" data-highlighter="prismjs" data-ext="ts"><pre><code><span class="line"><span class="token comment">// è°ƒè¯•é’©å­æ¥å£</span></span>
<span class="line"><span class="token keyword">export</span> <span class="token keyword">interface</span> <span class="token class-name">DebuggerOptions</span> <span class="token punctuation">{</span></span>
<span class="line">  onTrack<span class="token operator">?</span><span class="token operator">:</span> <span class="token punctuation">(</span>event<span class="token operator">:</span> DebuggerEvent<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token keyword">void</span></span>
<span class="line">  onTrigger<span class="token operator">?</span><span class="token operator">:</span> <span class="token punctuation">(</span>event<span class="token operator">:</span> DebuggerEvent<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token keyword">void</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">// è°ƒè¯•äº‹ä»¶</span></span>
<span class="line"><span class="token keyword">export</span> <span class="token keyword">type</span> <span class="token class-name">DebuggerEvent</span> <span class="token operator">=</span> <span class="token punctuation">{</span></span>
<span class="line">  effect<span class="token operator">:</span> Subscriber</span>
<span class="line"><span class="token punctuation">}</span> <span class="token operator">&amp;</span> DebuggerEventExtraInfo</span>
<span class="line"></span>
<span class="line"><span class="token keyword">export</span> <span class="token keyword">type</span> <span class="token class-name">DebuggerEventExtraInfo</span> <span class="token operator">=</span> <span class="token punctuation">{</span></span>
<span class="line">  target<span class="token operator">:</span> object</span>
<span class="line">  type<span class="token operator">:</span> TrackOpTypes <span class="token operator">|</span> TriggerOpTypes</span>
<span class="line">  key<span class="token operator">:</span> <span class="token builtin">any</span></span>
<span class="line">  newValue<span class="token operator">?</span><span class="token operator">:</span> <span class="token builtin">any</span></span>
<span class="line">  oldValue<span class="token operator">?</span><span class="token operator">:</span> <span class="token builtin">any</span></span>
<span class="line">  oldTarget<span class="token operator">?</span><span class="token operator">:</span> Map<span class="token operator">&lt;</span><span class="token builtin">any</span><span class="token punctuation">,</span> <span class="token builtin">any</span><span class="token operator">&gt;</span> <span class="token operator">|</span> Set<span class="token operator">&lt;</span><span class="token builtin">any</span><span class="token operator">&gt;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_2-é”™è¯¯å¤„ç†" tabindex="-1"><a class="header-anchor" href="#_2-é”™è¯¯å¤„ç†"><span>2. é”™è¯¯å¤„ç†</span></a></h3><div class="language-typescript line-numbers-mode" data-highlighter="prismjs" data-ext="ts"><pre><code><span class="line"><span class="token comment">// é€’å½’é™åˆ¶</span></span>
<span class="line"><span class="token keyword">const</span> <span class="token constant">RECURSION_LIMIT</span> <span class="token operator">=</span> <span class="token number">100</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">// é€’å½’æ£€æŸ¥</span></span>
<span class="line"><span class="token keyword">function</span> <span class="token function">checkRecursiveUpdates</span><span class="token punctuation">(</span>seen<span class="token operator">:</span> CountMap<span class="token punctuation">,</span> fn<span class="token operator">:</span> SchedulerJob<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>seen<span class="token punctuation">.</span><span class="token function">has</span><span class="token punctuation">(</span>fn<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    seen<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span>fn<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span></span>
<span class="line">  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">const</span> count <span class="token operator">=</span> seen<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>fn<span class="token punctuation">)</span><span class="token operator">!</span></span>
<span class="line">    <span class="token keyword">if</span> <span class="token punctuation">(</span>count <span class="token operator">&gt;</span> <span class="token constant">RECURSION_LIMIT</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">      <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span></span>
<span class="line">        <span class="token string">&#39;Maximum recursive updates exceeded. &#39;</span> <span class="token operator">+</span></span>
<span class="line">          <span class="token string">&#39;This means you have a reactive effect that is mutating its own &#39;</span> <span class="token operator">+</span></span>
<span class="line">          <span class="token string">&#39;dependencies, thus causing the effect to run infinitely.&#39;</span><span class="token punctuation">,</span></span>
<span class="line">      <span class="token punctuation">)</span></span>
<span class="line">    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span></span>
<span class="line">      seen<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span>fn<span class="token punctuation">,</span> count <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="ğŸ“Š-æ€§èƒ½ä¼˜åŒ–" tabindex="-1"><a class="header-anchor" href="#ğŸ“Š-æ€§èƒ½ä¼˜åŒ–"><span>ğŸ“Š æ€§èƒ½ä¼˜åŒ–</span></a></h2><h3 id="_1-å†…å­˜ä¼˜åŒ–" tabindex="-1"><a class="header-anchor" href="#_1-å†…å­˜ä¼˜åŒ–"><span>1. å†…å­˜ä¼˜åŒ–</span></a></h3><div class="language-typescript line-numbers-mode" data-highlighter="prismjs" data-ext="ts"><pre><code><span class="line"><span class="token comment">// WeakMapé¿å…å†…å­˜æ³„æ¼</span></span>
<span class="line"><span class="token keyword">export</span> <span class="token keyword">const</span> targetMap<span class="token operator">:</span> WeakMap<span class="token operator">&lt;</span>object<span class="token punctuation">,</span> Map<span class="token operator">&lt;</span><span class="token builtin">any</span><span class="token punctuation">,</span> Dep<span class="token operator">&gt;&gt;</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">WeakMap</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">// åŒå‘é“¾è¡¨O(1)æ“ä½œ</span></span>
<span class="line"><span class="token keyword">class</span> <span class="token class-name">Link</span> <span class="token punctuation">{</span></span>
<span class="line">  nextDep<span class="token operator">?</span><span class="token operator">:</span> Link</span>
<span class="line">  prevDep<span class="token operator">?</span><span class="token operator">:</span> Link</span>
<span class="line">  nextSub<span class="token operator">?</span><span class="token operator">:</span> Link</span>
<span class="line">  prevSub<span class="token operator">?</span><span class="token operator">:</span> Link</span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_2-è®¡ç®—ä¼˜åŒ–" tabindex="-1"><a class="header-anchor" href="#_2-è®¡ç®—ä¼˜åŒ–"><span>2. è®¡ç®—ä¼˜åŒ–</span></a></h3><div class="language-typescript line-numbers-mode" data-highlighter="prismjs" data-ext="ts"><pre><code><span class="line"><span class="token comment">// æ‡’è®¡ç®—</span></span>
<span class="line"><span class="token keyword">class</span> <span class="token class-name">ComputedRefImpl<span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">&gt;</span></span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token keyword">get</span> <span class="token function">value</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token constant">T</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">this</span><span class="token punctuation">.</span>dep<span class="token punctuation">.</span><span class="token function">track</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token function">refreshComputed</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span> <span class="token comment">// åªåœ¨éœ€è¦æ—¶é‡æ–°è®¡ç®—</span></span>
<span class="line">    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_value</span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">// ç‰ˆæœ¬æ§åˆ¶å¿«é€Ÿè·¯å¾„</span></span>
<span class="line"><span class="token keyword">if</span> <span class="token punctuation">(</span>computed<span class="token punctuation">.</span>globalVersion <span class="token operator">===</span> globalVersion<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token keyword">return</span> computed<span class="token punctuation">.</span>_value <span class="token comment">// è·³è¿‡è®¡ç®—</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="ğŸ¯-æ€»ç»“" tabindex="-1"><a class="header-anchor" href="#ğŸ¯-æ€»ç»“"><span>ğŸ¯ æ€»ç»“</span></a></h2><p>Vue3çš„å“åº”å¼ç³»ç»Ÿå±•ç°äº†ç°ä»£å“åº”å¼æ¡†æ¶çš„è®¾è®¡ç²¾é«“ï¼š</p><ol><li><strong>ç²¾ç¡®è¿½è¸ª</strong> - åªè¿½è¸ªå®é™…ä½¿ç”¨çš„ä¾èµ–</li><li><strong>é«˜æ•ˆæ•°æ®ç»“æ„</strong> - WeakMap + åŒå‘é“¾è¡¨</li><li><strong>æ™ºèƒ½ç‰ˆæœ¬æ§åˆ¶</strong> - é¿å…ä¸å¿…è¦çš„é‡æ–°è®¡ç®—</li><li><strong>ä¼˜é›…æ‰¹é‡æ›´æ–°</strong> - æ‰¹é‡å¤„ç†æé«˜æ€§èƒ½</li><li><strong>å®Œå–„å†…å­˜ç®¡ç†</strong> - WeakMapè‡ªåŠ¨GC</li><li><strong>å¼ºå¤§è°ƒè¯•æ”¯æŒ</strong> - å®Œæ•´çš„å¼€å‘å·¥å…·é›†æˆ</li></ol><p>è¿™å¥—å“åº”å¼ç³»ç»Ÿä¸ä»…ä¸ºVue3æä¾›äº†å¼ºå¤§çš„å“åº”å¼èƒ½åŠ›ï¼Œä¹Ÿä¸ºå…¶ä»–éœ€è¦å“åº”å¼åŠŸèƒ½çš„é¡¹ç›®æä¾›äº†ä¼˜ç§€çš„è®¾è®¡å‚è€ƒã€‚</p>`,58)]))}const i=s(t,[["render",l]]),u=JSON.parse('{"path":"/02-reactivity-system.html","title":"Vue3å“åº”å¼ç³»ç»Ÿè¯¦è§£","lang":"zh-CN","frontmatter":{},"headers":[{"level":2,"title":"ğŸ¯ å“åº”å¼ç³»ç»Ÿæ¦‚è¿°","slug":"ğŸ¯-å“åº”å¼ç³»ç»Ÿæ¦‚è¿°","link":"#ğŸ¯-å“åº”å¼ç³»ç»Ÿæ¦‚è¿°","children":[{"level":3,"title":"ç³»ç»Ÿæ¶æ„å›¾","slug":"ç³»ç»Ÿæ¶æ„å›¾","link":"#ç³»ç»Ÿæ¶æ„å›¾","children":[]}]},{"level":2,"title":"ğŸ”„ æ ¸å¿ƒæ¦‚å¿µ","slug":"ğŸ”„-æ ¸å¿ƒæ¦‚å¿µ","link":"#ğŸ”„-æ ¸å¿ƒæ¦‚å¿µ","children":[{"level":3,"title":"1. ä¸‰å¤§æ ¸å¿ƒå‡½æ•°","slug":"_1-ä¸‰å¤§æ ¸å¿ƒå‡½æ•°","link":"#_1-ä¸‰å¤§æ ¸å¿ƒå‡½æ•°","children":[]},{"level":3,"title":"2. æ ¸å¿ƒæ•°æ®ç»“æ„","slug":"_2-æ ¸å¿ƒæ•°æ®ç»“æ„","link":"#_2-æ ¸å¿ƒæ•°æ®ç»“æ„","children":[]}]},{"level":2,"title":"ğŸ›ï¸ å“åº”å¼API","slug":"ğŸ›ï¸-å“åº”å¼api","link":"#ğŸ›ï¸-å“åº”å¼api","children":[{"level":3,"title":"1. reactive() - æ·±åº¦å“åº”å¼","slug":"_1-reactive-æ·±åº¦å“åº”å¼","link":"#_1-reactive-æ·±åº¦å“åº”å¼","children":[]},{"level":3,"title":"2. ref() - å“åº”å¼å¼•ç”¨","slug":"_2-ref-å“åº”å¼å¼•ç”¨","link":"#_2-ref-å“åº”å¼å¼•ç”¨","children":[]},{"level":3,"title":"3. computed() - è®¡ç®—å±æ€§","slug":"_3-computed-è®¡ç®—å±æ€§","link":"#_3-computed-è®¡ç®—å±æ€§","children":[]},{"level":3,"title":"4. watch() - ä¾¦å¬å™¨","slug":"_4-watch-ä¾¦å¬å™¨","link":"#_4-watch-ä¾¦å¬å™¨","children":[]}]},{"level":2,"title":"ğŸ”§ ä¾èµ–è¿½è¸ªæœºåˆ¶","slug":"ğŸ”§-ä¾èµ–è¿½è¸ªæœºåˆ¶","link":"#ğŸ”§-ä¾èµ–è¿½è¸ªæœºåˆ¶","children":[{"level":3,"title":"1. ä¾èµ–æ”¶é›†æµç¨‹","slug":"_1-ä¾èµ–æ”¶é›†æµç¨‹","link":"#_1-ä¾èµ–æ”¶é›†æµç¨‹","children":[]},{"level":3,"title":"2. ä¾èµ–è§¦å‘æµç¨‹","slug":"_2-ä¾èµ–è§¦å‘æµç¨‹","link":"#_2-ä¾èµ–è§¦å‘æµç¨‹","children":[]}]},{"level":2,"title":"ğŸ¯ Effectç”Ÿå‘½å‘¨æœŸ","slug":"ğŸ¯-effectç”Ÿå‘½å‘¨æœŸ","link":"#ğŸ¯-effectç”Ÿå‘½å‘¨æœŸ","children":[{"level":3,"title":"1. Effectè¿è¡Œæµç¨‹","slug":"_1-effectè¿è¡Œæµç¨‹","link":"#_1-effectè¿è¡Œæµç¨‹","children":[]},{"level":3,"title":"2. ä¾èµ–æ¸…ç†æœºåˆ¶","slug":"_2-ä¾èµ–æ¸…ç†æœºåˆ¶","link":"#_2-ä¾èµ–æ¸…ç†æœºåˆ¶","children":[]}]},{"level":2,"title":"ğŸ›ï¸ ç‰ˆæœ¬æ§åˆ¶ä¼˜åŒ–","slug":"ğŸ›ï¸-ç‰ˆæœ¬æ§åˆ¶ä¼˜åŒ–","link":"#ğŸ›ï¸-ç‰ˆæœ¬æ§åˆ¶ä¼˜åŒ–","children":[{"level":3,"title":"1. ç‰ˆæœ¬å·æœºåˆ¶","slug":"_1-ç‰ˆæœ¬å·æœºåˆ¶","link":"#_1-ç‰ˆæœ¬å·æœºåˆ¶","children":[]},{"level":3,"title":"2. å¿«é€Ÿè·¯å¾„æ£€æŸ¥","slug":"_2-å¿«é€Ÿè·¯å¾„æ£€æŸ¥","link":"#_2-å¿«é€Ÿè·¯å¾„æ£€æŸ¥","children":[]}]},{"level":2,"title":"ğŸ“¦ æ‰¹é‡æ›´æ–°æœºåˆ¶","slug":"ğŸ“¦-æ‰¹é‡æ›´æ–°æœºåˆ¶","link":"#ğŸ“¦-æ‰¹é‡æ›´æ–°æœºåˆ¶","children":[{"level":3,"title":"1. æ‰¹é‡å¤„ç†","slug":"_1-æ‰¹é‡å¤„ç†","link":"#_1-æ‰¹é‡å¤„ç†","children":[]},{"level":3,"title":"2. ä»»åŠ¡é˜Ÿåˆ—","slug":"_2-ä»»åŠ¡é˜Ÿåˆ—","link":"#_2-ä»»åŠ¡é˜Ÿåˆ—","children":[]}]},{"level":2,"title":"ğŸ”§ é›†åˆç±»å‹æ”¯æŒ","slug":"ğŸ”§-é›†åˆç±»å‹æ”¯æŒ","link":"#ğŸ”§-é›†åˆç±»å‹æ”¯æŒ","children":[{"level":3,"title":"1. é›†åˆå¤„ç†å™¨","slug":"_1-é›†åˆå¤„ç†å™¨","link":"#_1-é›†åˆå¤„ç†å™¨","children":[]},{"level":3,"title":"2. ç‰¹æ®Šé”®å€¼å¤„ç†","slug":"_2-ç‰¹æ®Šé”®å€¼å¤„ç†","link":"#_2-ç‰¹æ®Šé”®å€¼å¤„ç†","children":[]}]},{"level":2,"title":"ğŸ› è°ƒè¯•æ”¯æŒ","slug":"ğŸ›-è°ƒè¯•æ”¯æŒ","link":"#ğŸ›-è°ƒè¯•æ”¯æŒ","children":[{"level":3,"title":"1. å¼€å‘é’©å­","slug":"_1-å¼€å‘é’©å­","link":"#_1-å¼€å‘é’©å­","children":[]},{"level":3,"title":"2. é”™è¯¯å¤„ç†","slug":"_2-é”™è¯¯å¤„ç†","link":"#_2-é”™è¯¯å¤„ç†","children":[]}]},{"level":2,"title":"ğŸ“Š æ€§èƒ½ä¼˜åŒ–","slug":"ğŸ“Š-æ€§èƒ½ä¼˜åŒ–","link":"#ğŸ“Š-æ€§èƒ½ä¼˜åŒ–","children":[{"level":3,"title":"1. å†…å­˜ä¼˜åŒ–","slug":"_1-å†…å­˜ä¼˜åŒ–","link":"#_1-å†…å­˜ä¼˜åŒ–","children":[]},{"level":3,"title":"2. è®¡ç®—ä¼˜åŒ–","slug":"_2-è®¡ç®—ä¼˜åŒ–","link":"#_2-è®¡ç®—ä¼˜åŒ–","children":[]}]},{"level":2,"title":"ğŸ¯ æ€»ç»“","slug":"ğŸ¯-æ€»ç»“","link":"#ğŸ¯-æ€»ç»“","children":[]}],"git":{"updatedTime":1754567332000,"contributors":[{"name":"atian","username":"atian","email":"atian@micous.com","commits":1,"url":"https://github.com/atian"}],"changelog":[{"hash":"fc80bf956ce2f65021db3835863d30f81c328ee4","time":1754567332000,"email":"atian@micous.com","author":"atian","message":"æ›´æ–°GitHub Actionsæ–‡æ¡£ï¼Œæ·»åŠ ä»£ç å—æ ¼å¼åŒ–ï¼Œè¡¥å……ç›¸å…³é“¾æ¥ï¼Œå¹¶åœ¨VuePressé…ç½®ä¸­æ–°å¢Vue3æ ¸å¿ƒçŸ¥è¯†çš„å¯¼èˆªå’Œä¾§è¾¹æ ï¼Œä¼˜åŒ–é¡µé¢è·¯ç”±è®¾ç½®ã€‚"}]},"filePathRelative":"02-reactivity-system.md"}');export{i as comp,u as data};
